<h1 class="xl-top-margin">Checkout</h1>
<div class="row">
  <div class="col-sm-6 box-with-shadow">

    <%= form_for @order, url: checkout_submit_path, :html => {:class => "form-group"} do |f| %>
      <% if @order.errors.any? %>
        <div id="error_explanation">
          <ul>
          <% @order.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
          </ul>
        </div>
      <% end %>

      <%= render "#{@order.current_step}_step", :f => f %>

      <br>
      <div class="actions">
        <%= f.submit value: "Continue", class:"btn btn-primary" %>
        <%= f.submit value: "Back", name:"back_button", class:"btn btn-primary" unless @order.first_step? %>
      </div>
    <% end %>
  </div>


  <div class="col-xs-12 col-sm-5 col-sm-offset-1 box-with-shadow">
    <h3>Purchase Summary</h3>
    <table class="table table-hover">
      <thead>
        <th>Product</th>
        <th class="text-center">Quantity</th>
        <th class="text-right">Subtotal</th>
      </thead>
      <% total = 0 %>
      <% @order_items.each do |oi| %>
      <tr>
        <td><%= oi.product.name %></td>
        <td class="text-center"><%= oi.quantity %></td>
        <% subtotal = oi.product.price * oi.quantity %>
        <% total += subtotal %>
        <td class="text-right"><%= dollar_price(subtotal) %></td>
      </tr>
      <% end %>
      <tfoot>
        <td></td>
        <td class="text-right"><strong>Total: </strong></td>
        <td class="text-right"><%= dollar_price(total) %></td>
      </tfoot>
    </table>
  </div>
</div>
